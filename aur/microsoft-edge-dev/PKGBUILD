pkgname=microsoft-edge-dev
pkgver=87.0.664.8
pkgrel=1
pkgdesc="The modern web browser by Microsoft"
arch=('x86_64')
url="https://www.microsoft.com/en-us/edge"
license=('custom:edge')
depends=('alsa-lib' 'gtk3' 'libcups' 'libxss' 'libxtst' 'nss')
optdepends=(
	'libpipewire02: WebRTC desktop sharing under Wayland'
	'kdialog: for file dialogs in KDE'
	'gnome-keyring: for storing passwords in GNOME keyring'
	'kwallet: for storing passwords in KWallet'
	'gtk3-print-backends: for printing'
	'libunity: for download progress on KDE'
	'ttf-liberation: fix fonts for some PDFs - CRBug #369991'
	'xdg-utils'
)
options=('!emptydirs' '!strip')
_channel=dev
source=("microsoft-edge-${_channel}_${pkgver}-${pkgrel}_amd64.deb"
	"microsoft-edge-$_channel.sh")
sha512sums=('SKIP'
            'SKIP')
provides=('microsoft-edge')
conflicts=('microsoft-edge-unstable')

package() {
	bsdtar -xf data.tar.xz -C "$pkgdir/"

	# Launcher
	install -m755 microsoft-edge-$_channel.sh "$pkgdir"/usr/bin/microsoft-edge-$_channel

	# Icons
	for i in 16 24 32 48 64 128 256; do
		install -Dm644 "$pkgdir"/opt/microsoft/msedge-$_channel/product_logo_${i/x*/}_dev.png \
			"$pkgdir"/usr/share/icons/hicolor/$i/apps/microsoft-edge.png
	done

	rm -r "$pkgdir"/etc/cron.daily/ "$pkgdir"/opt/microsoft/msedge-$_channel/cron/
	rm "$pkgdir"/opt/microsoft/msedge-$_channel/product_logo_*.png
}
